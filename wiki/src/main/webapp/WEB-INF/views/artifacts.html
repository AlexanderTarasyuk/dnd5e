<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="layouts/default">
<head>
<title>DnD 5E Артифакты</title>
<meta charset="utf-8">

<link rel="icon" th:href="@{/resources/icon.png}">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</head>
<body>
	<div th:insert="fragments/header :: header(~{ :: .artifactes})"></div>

	<div class="container" style="margin-top: 60px">
		<div class="card">
			<div class="card-body">
				<h5 class="panel-heading">Фильтр</h5>
				<select id="artifactType" class="form-control"
					onchange="filter(this)">
					<option value="ALL">все</option>
					<option th:each="type : ${artifactTypes}" th:value="${type}"
						th:text="${type.cyrilicName}" th:selected="${type==typeSelected}">
				</select> <select id="rarityType" class="form-control"
					onchange="filter(this)">
					<option value="ALL">все</option>
					<option th:each="rarity : ${rarityTypes}" th:value="${rarity}"
						th:text="${rarity.cyrilicName}"
						th:selected="${rarity==raritySelected}">
				</select>
			</div>
		</div>
		<table class="table table-striped">
			<thead>
				<tr style="cursor: pointer">
					<th onclick="sortTable(0)" scope="col">Наименование <span
						th:if="${order==0 && dir=='asc'}"
						class="glyphicon glyphicon-arrow-down"></span> <span
						th:if="${order==0 && dir=='desc'}"
						class="glyphicon glyphicon-arrow-up"></span>
					</th>
					<th onclick="sortTable(1)" scope="col">Редкость <span
						th:if="${order==1 && dir=='asc'}"
						class="glyphicon glyphicon-arrow-down"></span> <span
						th:if="${order==1 && dir=='desc'}"
						class="glyphicon glyphicon-arrow-up"></span>
					</th>
					<th onclick="sortTable(2)" scope="col">Тип <span
						th:if="${order==2 && dir=='asc'}"
						class="glyphicon glyphicon-arrow-down"></span> <span
						th:if="${order==2 && dir=='desc'}"
						class="glyphicon glyphicon-arrow-up"></span>
					</th>
				</tr>
			</thead>
			<tr th:each="artifact : ${artifacts}" style="cursor: pointer"
				th:onclick="'javascript:rowClicked(\'' + ${artifact.id} + '\');'">
				<td th:text="${artifact.name}" />
				<td th:text="${artifact.rarity.cyrilicName}" />
				<td th:text="${artifact.type.cyrilicName}" />
			</tr>
		</table>

	</div>
</body>
<script>
	function rowClicked(value) {
		var baseUrl = '[[@{/artifacts/artifact/}]]';
		location.href = baseUrl + value;
	}
	function sortTable(n) {
		var baseUrl = '[[@{/artifacts}]]';
		var order = getParameterByName('order');
		var dir = getParameterByName('dir');
		if (dir == 'desc' && order == n) {
			location.href = baseUrl + "?order=" + n + "&dir=asc";
		} else {
			location.href = baseUrl + "?order=" + n + "&dir=desc";
		}
	}
	function getParameterByName(name, url) {
		if (!url)
			url = window.location.href;
		name = name.replace(/[\[\]]/g, "\\$&");
		var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"), results = regex
				.exec(url);
		if (!results)
			return null;
		if (!results[2])
			return '';
		return decodeURIComponent(results[2].replace(/\+/g, " "));
	}
	function filter(select) {
		var baseUrl = '[[@{/artifacts?}]]';
		var type = $("#artifactType").val();
		var rarity = $("#rarityType").val();
		window.location = baseUrl + "type=" + type + "&rarity=" + rarity;
	}
</script>
</html>